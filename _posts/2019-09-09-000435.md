---
title: "読書記録: ディジタル回路設計とコンピュータアーキテクチャ"
layout: page	
---

<iframe style="width:120px;height:240px;" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" src="https://rcm-fe.amazon-adsystem.com/e/cm?ref=qf_sp_asin_til&t=karino203-22&m=amazon&o=9&p=8&l=as1&IS1=1&detail=1&asins=B074H9C84X&bc1=ffffff&lt1=_top&fc1=333333&lc1=0066c0&bg1=ffffff&f=ifr"> </iframe>

Kindleの半額セールを眺めてて見つけた本。
VerilogとかでMIPSを作っていく、という題材で、プロセッサを勉強する、という本。FPGAで動きそうだし、作りながら勉強出来たらいいな。

# 1章 2進数とかゲートとか

1.5の2進数とかゲートくらいまでは別段見る所は無い。

1.6のゲートの実現周りは物理的な特性の話とか出てくるので一応真面目に読む。

1.7は半導体の話。nMOSとかpMOSの話はこれまでの人生で何度も読んでるはずだが毎回わすれてるので、きっと身につかない気はする。

一章、たぶん要らない割には結構読むのに時間が掛かった。
こういうの、あんまり詳しくないので出てくる都度真面目に読んでしまうが、効率という点では飛ばした方がいいんだろうなぁ。

ただpMOSとnMOSの話はそれなりに勉強になった気もするので、読んで無駄だったという気もしない。

# 2章 組み合わせ回路とかブール代数とか

組み合わせ回路（タイミングが無い奴）も本題からすると要らなさそうなので飛ばして良いと思うのだが、
この辺もそんなにしっかりマスターしてる訳じゃないのでつい真面目に読んでしまう。

### 例題 2.10 デジタル表示のカルノーマップ

例題 2.10は暗算で解け無さそうなのでメモをここに書く。
表2.6からカルノーマップを書こう。

まずはSa。

![images/2019-09-09-000435/0000.png]({{"/assets/images/2019-09-09-000435/0000.png" | absolute_url}})

これを2のべき乗となるなるべく大きな丸でくくる。

![images/2019-09-09-000435/0001.png]({{"/assets/images/2019-09-09-000435/0001.png" | absolute_url}})

この図から読み取ると以下か？

![images/2019-09-09-000435/0002.png]({{"/assets/images/2019-09-09-000435/0002.png" | absolute_url}})

合ってそう。他はまぁいいだろう。

# 3章 順序回路

このへんまでは以前デジタル回路の本でやったはずなので、ガンガン進めてとっとと4章に入りたい。

### 3.2 ラッチとフリップフロップ

サクサク進んだところ、フリップフロップのあたりで分からない言葉がちょこちょこ出てくるので2章の該当箇所を見直し。

- 伝送ゲート
- バッファ
- トライステートバッファ
- アクティブHigh とバー

1章や2章は飛ばそうか悩んだが、軽く読んでおいて良かったな。

### 例題3.6 N進カウンタ

まずはバイナリ表現。

![images/2019-09-09-000435/0003.jpg]({{"/assets/images/2019-09-09-000435/0003.jpg" | absolute_url}})

答えを見るとS0とS1が逆だが、これはどちらでも良かろう。
S1'にS1バーがかかってる所が違うな。これ要らない気がするが。

とりあえず次のワンホットをやるか。

![images/2019-09-09-000435/0004.jpg]({{"/assets/images/2019-09-09-000435/0004.jpg" | absolute_url}})

### 例題3.9 回路からFSMの導出

練習の為やってみる。
S1がアンロックと言ってるから、これが1になればいいのかな。

まずは状態表を書く。
全通り書こうとしたら16通りくらいあって辛いので、ちょっとサボれないか考える。

1つ目のANDは、A0かA1バーならdon't careだな。この辺に着目してさぼれる所はさぼるか。

![images/2019-09-09-000435/0005.jpg]({{"/assets/images/2019-09-09-000435/0005.jpg" | absolute_url}})

この表を眺めつつ状態遷移図を描く。

![images/2019-09-09-000435/0006.jpg]({{"/assets/images/2019-09-09-000435/0006.jpg" | absolute_url}})

つまり11を入れてから01を入れると開く訳だな。

回答を見ると、出力表の所がじぶんの手順には無いな。
S1と一致してるから必要性は感じないが、正しい手順という点では作るべきだったか。

まぁこの辺は今後必要ならやる機会はあるだろうからこの位で良かろう。

### 3章後半は読むだけ

タイミング分析とかは軽く頭の中でやってみて少し間違えてたが結果は納得した、くらいで先に進む。
この手のはちゃんとマスターしようと思えばいくつか練習問題をやらないとダメそうだが、どうせあんま使わんだろう、という事で。

必要になったら戻ってきてちゃんとやる（ゆとり）

# 4章 ハードウェア記述言語

ようやく本題の4章まで来た！
少し最初の方を読んだが、やはり動かす環境が欲しいな。
とりあえず手元のFPGAを動かしてみるのが先か。

### FPGA環境設定

本はAltera前提だが、別のFPGAを借りれたので自分はこれで行く。
まずはツールをダウンロード。

Xilinxのツールを使う、との事なので、vivadoのwebpack版というのをダウンロードした。

次にツールの使い方をググって、ここを見つける。

[Getting Started with Vivado](https://reference.digilentinc.com/vivado/getting_started/start)

だいたいはこれに従うのだが、xdcファイルの所だけ具体的なボードによるので、そこだけ自分でやる。
xdcの該当する行をコメントアウトして使う。

get_portsの後にある変数名がverilog側でPort Nameとして指定できる。

という事でハードの人にいろいろ質問しつつLチカに成功！ご協力感謝。

### 4章を一通り読んで

手を動かそうと思ったが、どれも動作自体はみれば分かる例が多く、読むだけで最後まで辿り着いてしまった。
ただ理解出来たという感じでも無い。

Verilogの難しさというのは、たぶん記述とやってることの遠さにある気がする。
書かれている事の挙動は普通のプログラマなら見れば分かるが、「そう書かないといけない理由」がわからない。
何か実現したい事に対して、ハードウェア的に可能な形に変形する、という過程があって、その結果を記述していると思うのだよなぁ。

という事で正解を見てもいまいち重要なところを学べていない。
どうしよっかなぁ。
演習問題をやってみるか。

なお、途中からVHDLは見ずにSystem Verilogの方だけ見てた。
VHDLは記述がだる過ぎる。

### 5章一通り読み終わり

ちょっとPCの前に居ない事が多かったので、読むだけ先に読み進めていて、さきほど5章が読み終わった。
5章はALU、浮動小数点数（足し算のみ）、カウンタ、SRAM、DRAM、ロジックアレイという感じの内容。

5章の内容は、半分以上は昔どこかで読んだ事あるものが多いので、お話としてはこんなのあったな、くらいで読める。
ちゃんと理解出来てるという気もしないが、この辺は内容をざっと理解した上で実際にVerilog書きながら覚えていきたいのでまずはこの位でいいかな。

昔読んだ時はぼんやりとした理解だったが、今回は前よりはちゃんと理解出来た気がする。二回目か三回目か覚えてないが反復した結果、理解度が上がってるっぽい。

FPGAのあたりは初めて見る気がする。あまり理解出来た気はしないのでそのうちまたちゃんと勉強する機会が欲しいな。

### 6章も一通り読んだ

最後のx86は飛ばしたし、読まなくても分かるC言語のコードをどうアセンブルするか、みたいなのは飛ばしたが、ニモニックとかは一通り見ておいた。
mipsこんな感じか。
なんか昔みたことあるなぁ。どこだったか思い出せないが。
この上の16bitにロードしてorするの、なんか記憶にある。WinCEか？忘れた。まぁいい。

だいたいmipsがどういうアーキテクチャかも分かったのであとは実装するだけだな。

### System Verilogを書いていくポストを作る

理屈は理解した、という事で実際に書いていきたい。
取りあえず4章の演習問題を幾つか解いてみて感じをつかみ、その後の進め方を決めたいな。

PCから書く方がいいな。ページ分けるか。

[System Verilogを書くぞ！](https://karino2.github.io/2019/09/19/verilog_intro.html)


---
title: C++でシンボリックなツリーを扱うライブラリとかは無いものか？
layout: page
---
今回仕事では計算グラフを作るにあたり、ツリーはライブラリ的な汎用の物を作ったのだが、
その中身は普通にクラスとかstructを作って入れている。
で、全ノードにequalityとか大小比較とかを実装しては居ないので、
mapに入れられなくて困ったりとかいまいちな事が結構ある。

一方でシンボリックなツリーって非常に汎用なもので外部への依存も全然無いので、
ライブラリ化できても良さそうな気もする。単なるS式プロセッサみたいなもんだし。
そう考えれば、JSONのライブラリというのはかなりそれに近い物だな。
あれは辞書型みたいなのが汎用になってしまうのでもう少しtypedな物であって欲しいけれど。

シンボリックなツリーやその扱いがいい感じにライブラリ化されていれば、
DSLを使ってシンボリックなツリーを作ってそれを操作して最後に解釈する、
という類の構造を実装するのはずっとお手軽になり、いろんな問題に適用出来るようになる気がする。
なんとかできんかなぁ。

ノードのequalityだとかを実装するのを自動化しようと思えば、tupleみたいなテンプレートライブラリになるよなぁ。
一方でツリーのノードは同じサイズである必要があるだろうから、
ツリーにはunique_ptrを入れるんだろうか。そうするとポリモルフィックにする必要あるよなぁ。
いやぁ、ポリモルフィックにしちゃうとtupleのequalityそのままは使えないよなぁ。
ここが一番良くわからない所だが、ここさえ乗り切れれば作れそうな気もする。
なんとかならんかなぁ。
tupleをCRTPすればどうにかなる？

シンボリックなツリーのノードとしては、自身のノードの種類を表すenum値かなんかがあって、文字列とか数値とかの基礎的なメンバが持てて、
あとはなんかuser_data的なのがぶら下げられれば十分かねぇ。

ツリーは副作用レスというか、作り直ししか出来ない、という形がいいのかなぁ。
サブツリーだけ変更したい事は結構あるんだが、なんかまずい事はあるだろうか。
あるノードが別のツリーへの参照を持っているとそれがstaleになる事があるんだけど、
そういう事はあるのかな？あるなら毎回作り直しと割り切ってしまう方がいいかもしれない。
だいたいこの手のシンボリックなツリーってだいたいは大したサイズじゃないんだよな。
だから毎回作り直しでもまぁ平気な気はする。

うーむ、なんかそんなに簡単では無いが、頑張れば実現出来そうな気もするなぁ。
少しググった感じでは見つからなかったが。
BoostのPropertyTreeとか近そうなので、これを良く理解していれば作れそうな気もするが。